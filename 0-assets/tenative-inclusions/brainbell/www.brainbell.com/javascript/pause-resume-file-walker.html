<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from www.brainbell.com/javascript/pause-resume-file-walker.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Feb 2021 02:56:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="UTF-8">
<script data-ezscrex='false' data-cfasync='false' data-pagespeed-no-defer>var __ez=__ez||{};__ez.stms=Date.now();__ez.evt={};__ez.script={};__ez.ck=__ez.ck||{};__ez.template={};__ez.template.isOrig=true;__ez.queue=(function(){var count=0,incr=0,items=[],timeDelayFired=false,hpItems=[],lpItems=[],allowLoad=true;var obj={func:function(name,funcName,parameters,isBlock,blockedBy,deleteWhenComplete,proceedIfError){var self=this;this.name=name;this.funcName=funcName;this.parameters=parameters===null?null:(parameters instanceof Array)?parameters:[parameters];this.isBlock=isBlock;this.blockedBy=blockedBy;this.deleteWhenComplete=deleteWhenComplete;this.isError=false;this.isComplete=false;this.isInitialized=false;this.proceedIfError=proceedIfError;this.isTimeDelay=false;this.process=function(){log("... func = "+name);self.isInitialized=true;self.isComplete=true;log("... func.apply: "+name);var funcs=self.funcName.split('.');var func=null;if(funcs.length>3){}else if(funcs.length===3){func=window[funcs[0]][funcs[1]][funcs[2]];}else if(funcs.length===2){func=window[funcs[0]][funcs[1]];}else{func=window[self.funcName];}
if(typeof func!=='undefined'&&func!==null){func.apply(null,this.parameters);}
if(self.deleteWhenComplete===true)delete items[name];if(self.isBlock===true){log("----- F'D: "+self.name);processAll();}}},file:function(name,path,isBlock,blockedBy,async,defer,proceedIfError){var self=this;this.name=name;this.path=path;this.async=async;this.defer=defer;this.isBlock=isBlock;this.blockedBy=blockedBy;this.isInitialized=false;this.isError=false;this.isComplete=false;this.proceedIfError=proceedIfError;this.isTimeDelay=false;this.process=function(){self.isInitialized=true;log("... file = "+name);var scr=document.createElement('script');scr.src=path;if(async===true)scr.async=true;else if(defer===true)scr.defer=true;scr.onerror=function(){log("----- ERR'D: "+self.name);self.isError=true;if(self.isBlock===true){processAll();}};scr.onreadystatechange=scr.onload=function(){var state=scr.readyState;log("----- F'D: "+self.name);if((!state||/loaded|complete/.test(state))){self.isComplete=true;if(self.isBlock===true){processAll();}}};document.getElementsByTagName('head')[0].appendChild(scr);}}};function init(){window.addEventListener("load",function(){setTimeout(function(){timeDelayFired=true;log('TDELAY -----');processAll();},5000);},false);}
function addFile(name,path,isBlock,blockedBy,async,defer,proceedIfError,priority){var item=new obj.file(name,path,isBlock,blockedBy,async,defer,proceedIfError);if(priority===true){hpItems[name]=item}else{lpItems[name]=item}
items[name]=item;checkIfBlocked(item);}
function setallowLoad(settobool){allowLoad=settobool}
function addFunc(name,func,parameters,isBlock,blockedBy,autoInc,deleteWhenComplete,proceedIfError,priority){if(autoInc===true)name=name+"_"+incr++;var item=new obj.func(name,func,parameters,isBlock,blockedBy,deleteWhenComplete,proceedIfError);if(priority===true){hpItems[name]=item}else{lpItems[name]=item}
items[name]=item;checkIfBlocked(item);}
function addTimeDelayFile(name,path){var item=new obj.file(name,path,false,[],false,false,true);item.isTimeDelay=true;log(name+' ... '+' FILE! TDELAY');lpItems[name]=item;items[name]=item;checkIfBlocked(item);}
function addTimeDelayFunc(name,func,parameters){var item=new obj.func(name,func,parameters,false,[],true,true);item.isTimeDelay=true;log(name+' ... '+' FUNCTION! TDELAY');lpItems[name]=item;items[name]=item;checkIfBlocked(item);}
function checkIfBlocked(item){if(isBlocked(item)===true||allowLoad==false)return;item.process();}
function isBlocked(item){if(item.isTimeDelay===true&&timeDelayFired===false){log(item.name+" blocked = TIME DELAY!");return true;}
if(item.blockedBy instanceof Array){for(var i=0;i<item.blockedBy.length;i++){var block=item.blockedBy[i];if(items.hasOwnProperty(block)===false){log(item.name+" blocked = "+block);return true;}else if(item.proceedIfError===true&&items[block].isError===true){return false;}else if(items[block].isComplete===false){log(item.name+" blocked = "+block);return true;}}}
return false;}
function log(msg){var href=window.location.href;var reg=new RegExp('[?&]ezq=([^&#]*)','i');var string=reg.exec(href);var res=string?string[1]:null;if(res==="1")console.debug(msg);}
function processAll(){count++;if(count>200)return;log("let's go");processItems(hpItems);processItems(lpItems);}
function processItems(list){for(var i in list){if(list.hasOwnProperty(i)===false)continue;var item=list[i];if(item.isComplete===true||isBlocked(item)||item.isInitialized===true||item.isError===true){if(item.isError===true){log(item.name+': error')}else if(item.isComplete===true){log(item.name+': complete already')}else if(item.isInitialized===true){log(item.name+': initialized already')}}else{item.process();}}}
init();return{addFile:addFile,addDelayFile:addTimeDelayFile,addFunc:addFunc,addDelayFunc:addTimeDelayFunc,items:items,processAll:processAll,setallowLoad:setallowLoad};})();__ez.evt.add=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n()},__ez.evt.remove=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):delete e["on"+t]};__ez.script.add=function(e){var t=document.createElement("script");t.src=e,t.async=!0,t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t)};__ez.queue.addFile('https://www.brainbell.com/detroitchicago/boise.js', 'https://www.brainbell.com/detroitchicago/boise.js?gcb=192-11&amp;cb=1', false, [], true, false, true, false);__ez.dot={};__ez.queue.addFile('https://www.brainbell.com/detroitchicago/memphis.js', 'https://www.brainbell.com/detroitchicago/memphis.js?gcb=192-11&amp;cb=5', false, [], true, false, true, false);__ez.queue.addFile('https://www.brainbell.com/detroitchicago/minneapolis.js', 'https://www.brainbell.com/detroitchicago/minneapolis.js?gcb=192-11&amp;cb=3', false, [], true, false, true, false);__ez.vep=(function(){var pixels=[],pxURL="https://www.brainbell.com/detroitchicago/grapefruit.gif";function AddPixel(vID,pixelData){if(__ez.dot.isDefined(vID)&&__ez.dot.isValid(pixelData)){pixels.push({type:'video',video_impression_id:vID,domain_id:__ez.dot.getDID(),t_epoch:__ez.dot.getEpoch(0),data:__ez.dot.dataToStr(pixelData)});}}
function Fire(){if(typeof document.visibilityState!=='undefined'&&document.visibilityState==="prerender"){return;}
if(__ez.dot.isDefined(pixels)&&pixels.length>0){while(pixels.length>0){var j=5;if(j>pixels.length){j=pixels.length;}
var pushPixels=pixels.splice(0,j);var pixelURL=__ez.dot.getURL(pxURL)+"?orig="+(__ez.template.isOrig===true?1:0)+"&v="+btoa(JSON.stringify(pushPixels));__ez.dot.Fire(pixelURL);}}
pixels=[];}
return{Add:AddPixel,Fire:Fire};})();</script><script data-ezscrex='false' data-cfasync='false' data-pagespeed-no-defer>__ez.pel=(function(){var pixels=[],pxURL="https://www.brainbell.com/porpoiseant/army.gif";function AddAndFirePixel(adSlot,pixelData){AddPixel(adSlot,pixelData,0,0,0,0,0);Fire();}
function AddAndFireOrigPixel(adSlot,pixelData){AddPixel(adSlot,pixelData,0,0,0,0,0,true);Fire();}
function GetCurrentPixels(){return pixels;}
function AddPixel(adSlot,pixelData,revenue,est_revenue,bid_floor_filled,bid_floor_prev,stat_source_id,isOrig){if(!__ez.dot.isDefined(adSlot)||__ez.dot.isAnyDefined(adSlot.getSlotElementId,adSlot.ElementId)==false){return;}
var ad_position_id=parseInt(__ez.dot.getTargeting(adSlot,'ap'));var impId=__ez.dot.getSlotIID(adSlot),adUnit=__ez.dot.getAdUnit(adSlot,isOrig);var compId=parseInt(__ez.dot.getTargeting(adSlot,"compid"));var lineItemId=0;var creativeId=0;var ezimData=getEzimData(adSlot);if(typeof ezimData=='object'){if(ezimData.creative_id!==undefined){creativeId=ezimData.creative_id;}
if(ezimData.line_item_id!==undefined){lineItemId=ezimData.line_item_id;}}
if(__ez.dot.isDefined(impId,adUnit)&&__ez.dot.isValid(pixelData)){pixels.push({type:"impression",impression_id:impId,domain_id:__ez.dot.getDID(),unit:adUnit,t_epoch:__ez.dot.getEpoch(0),revenue:revenue,est_revenue:est_revenue,ad_position:ad_position_id,ad_size:"",bid_floor_filled:bid_floor_filled,bid_floor_prev:bid_floor_prev,stat_source_id:stat_source_id,country_code:__ez.dot.getCC(),pageview_id:__ez.dot.getPageviewId(),comp_id:compId,line_item_id:lineItemId,creative_id:creativeId,data:__ez.dot.dataToStr(pixelData),is_orig:isOrig||__ez.template.isOrig,});}}
function AddPixelById(impFullId,pixelData,isOrig){var vals=impFullId.split('https://www.brainbell.com/');if(__ez.dot.isDefined(impFullId)&&vals.length===3&&__ez.dot.isValid(pixelData)){var adUnit=vals[0],impId=vals[2];pixels.push({type:"impression",impression_id:impId,domain_id:__ez.dot.getDID(),unit:adUnit,t_epoch:__ez.dot.getEpoch(0),pageview_id:__ez.dot.getPageviewId(),data:__ez.dot.dataToStr(pixelData),is_orig:isOrig||__ez.template.isOrig});}}
function Fire(){if(typeof document.visibilityState!=='undefined'&&document.visibilityState==="prerender")return;if(__ez.dot.isDefined(pixels)&&pixels.length>0){var allPixels=[pixels.filter(function(pixel){return pixel.is_orig}),pixels.filter(function(pixel){return!pixel.is_orig})];allPixels.forEach(function(pixels){while(pixels.length>0){var isOrig=pixels[0].is_orig||false;var j=5;if(j>pixels.length){j=pixels.length;}
var pushPixels=pixels.splice(0,j);var pixelURL=__ez.dot.getURL(pxURL)+"?orig="+(isOrig===true?1:0)+"&sts="+btoa(JSON.stringify(pushPixels));if(typeof window.isAmp!=='undefined'&&isAmp&&typeof window._ezaq!=='undefined'&&_ezaq.hasOwnProperty("domain_id")){pixelURL+="&visit_uuid="+_ezaq['visit_uuid'];}
__ez.dot.Fire(pixelURL);}})}
pixels=[];}
function getEzimData(adSlot){if(typeof _ezim_d=="undefined"){return false}
var adUnitName=__ez.dot.getAdUnitPath(adSlot).split('https://www.brainbell.com/').pop();if(typeof _ezim_d==='object'&&_ezim_d.hasOwnProperty(adUnitName)){return _ezim_d[adUnitName];}
for(var ezimKey in _ezim_d){if(ezimKey.split('https://www.brainbell.com/').pop()===adUnitName){return _ezim_d[ezimKey];}}
return false;}
return{Add:AddPixel,AddAndFire:AddAndFirePixel,AddAndFireOrig:AddAndFireOrigPixel,AddById:AddPixelById,Fire:Fire,GetPixels:GetCurrentPixels,};})();__ez.queue.addFile('https://www.brainbell.com/detroitchicago/raleigh.js', 'https://www.brainbell.com/detroitchicago/raleigh.js?gcb=192-11&amp;cb=3', false, [], true, false, true, false);__ez.queue.addFile('https://www.brainbell.com/detroitchicago/tampa.js', 'https://www.brainbell.com/detroitchicago/tampa.js?gcb=192-11&amp;cb=3', false, [], true, false, true, false);</script>
<script data-ezscrex="false" data-cfasync="false">(function(){if("function"===typeof window.CustomEvent)return!1;window.CustomEvent=function(c,a){a=a||{bubbles:!1,cancelable:!1,detail:null};var b=document.createEvent("CustomEvent");b.initCustomEvent(c,a.bubbles,a.cancelable,a.detail);return b}})();</script><script data-ezscrex="false" data-cfasync="false">__ez.queue.addFile('https://www.brainbell.com/detroitchicago/tulsa.js', 'https://www.brainbell.com/detroitchicago/tulsa.js?gcb=192-11&amp;cb=5', false, [], true, false, true, false);</script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Creating resumable pausable file walker in Node.js</title>
<meta name="description" content="Learn how to create a event driven asynchronous filewalker app which can pause and resume by user input.">
<link rel="shortcut icon" href="https://www.brainbell.com/favicon.ico" >
<style type="text/css">
*,*::before,*::after {box-sizing: border-box}
html {font-family: sans-serif;line-height: 1.15;-webkit-text-size-adjust: 100%;-ms-text-size-adjust: 100%;-ms-overflow-style: scrollbar;-webkit-tap-highlight-color: rgba(0, 0, 0, 0)}
@-ms-viewport {width: device-width}
article, aside, figcaption, figure, footer, header, hgroup, main, nav, section {display: block}
body {margin: 0;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size: 1.1rem;font-weight: 400;line-height: 1.5;color: #212529;text-align: left;background-color: #fff}
[tabindex="-1"]:focus {outline: 0 !important}
hr {box-sizing: content-box;height: 0;overflow: visible;margin-top: 1rem;margin-bottom: 1rem;border: 0;border-top: 1px solid rgba(0, 0, 0, 0.1)}
h1, h2, h3, h4, h5, h6{margin-top: 0;margin-bottom: 0.5rem;font-family: inherit;font-weight: 500;line-height: 1.2;color: inherit}
h1{font-size: 2.5rem}h2{font-size: 2rem}h3{font-size: 1.75rem}h4{font-size: 1.5rem}h5{font-size: 1.3rem}h6{font-size: 1.2rem}
p {margin-top: 0;margin-bottom: 1rem}
abbr[title],abbr[data-original-title] {text-decoration: underline;-webkit-text-decoration: underline dotted;text-decoration: underline dotted;cursor: help;border-bottom: 0}
address {margin-bottom: 1rem;font-style: normal;line-height: inherit}

ol,ul,dl {margin-top: 0;margin-bottom: 1rem}ol ol,ul ul,ol ul,ul ol {margin-bottom: 0}
dt {font-weight: 700;}
dd {margin-bottom: .5rem;margin-left: 0;}

blockquote {padding:1rem 3rem;margin: 3rem 0;position:relative;border-radius:1rem}

blockquote::before{content: "“";left: .5rem;top: 1.8rem}
blockquote::after{content: "”";right: 2.5rem;bottom: -1.5rem}

blockquote::after, blockquote::before{font-family: georgia;font-size: 5rem;height: 2.5rem;width: 0;display:block;position:absolute}

dfn {font-style: italic;} b,strong {font-weight: bolder;}
small{font-size: 80%;font-weight: 400}
sub,sup {position: relative;font-size: 75%;line-height: 0;vertical-align: baseline}
sub {bottom: -.25em}
sup {top: -.5em}

a {color: #0074D9;background-color: transparent;-webkit-text-decoration-skip: objects}
a:hover {color: #002633;text-decoration:none}
a:not([href]):not([tabindex]) {color: inherit;text-decoration: none}
a:not([href]):not([tabindex]):hover, a:not([href]):not([tabindex]):focus {color: inherit;text-decoration: none}
a:not([href]):not([tabindex]):focus {outline: 0}

pre,code,kbd,samp,.slog {font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 1em}
pre {margin-top: 0;margin-bottom: 2rem;overflow: auto;-ms-overflow-style: scrollbar;display: block;font-size: 87.5%;color: #212529;border:1px solid #eee !important;padding:.8rem !important;border-radius:8px;line-height:1.4rem}

figure {margin: 0 0 1rem}img {vertical-align: middle;border-style: none;border:0;height:auto;max-width:100%;width:auto} svg:not(:root) {overflow: hidden;vertical-align: middle}

table {border-collapse: collapse;width:100%;margin-bottom:2rem;}td,th{padding:0.25rem;border: 1px solid #dee2e6;}
blockquote,code, table tr:nth-of-type(2n) {background: #fbfbfb;}
caption {padding-top: 0.75rem;padding-bottom: 0.75rem;color: #6c757d;text-align: left;caption-side: bottom}
th {text-align: inherit}

summary {display: list-item;cursor: pointer}mark{padding: 0.2em;background-color: #fcf8e3}
code {color:#c7254e;word-break: break-word; font-size: 87.5%;}a > code {color: inherit}
kbd {padding: 0.2rem 0.4rem;color: #fff;background-color: #212529;border-radius: 0.2rem}
kbd kbd {padding: 0;font-weight: 700}
pre code {font-size: inherit;color: inherit;word-break: normal;}
video{display:block;max-width:75%}

.borderbox{border-left:3px solid #00f;padding:1rem 0.5rem 0;}
.line {margin: 0 auto;max-width: 71.25rem}.line:after{display: block;clear: both;content: "";}
.fullwidth{width:100%}

.button,#toc a{display:inline-block;cursor:pointer;text-align: center;white-space: nowrap;vertical-align: middle;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;border: 1px solid rgba(50,205,50,.5);padding: .375rem .75rem;line-height: 1.5;border-radius: .25rem;margin-bottom:0.3rem;color: #009600;text-decoration: none;}
.button ::-moz-focus-inner{padding: 0;border-style: none;}
#buttons{-webkit-box-pack:center;-ms-flex-pack: center;justify-content: center;padding: .5rem;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap: wrap;flex-wrap: wrap;-webkit-box-align: center;-ms-flex-align: center;align-items: center;display: -webkit-box;display: -ms-flexbox;display: flex;}
#navbar-brand {color: #000;display: inline-block;padding-top: .3125rem;padding-bottom: .3125rem;margin-left: 1rem;white-space: nowrap;-ms-touch-action: manipulation;touch-action: manipulation;text-decoration: none;background-color: transparent;-webkit-text-decoration-skip: objects;line-height: 1rem;font-size: 2.2rem;text-align: center}
#navbar-brand .bell {color: rgba(0,200,0,1)}
.slog {font-weight: normal;font-size: .85rem}
nav{padding:0.5rem;margin-top:0.5rem}
nav a.button{text-decoration:none;margin-left:0.3rem;flex:10rem}
#buttons{margin-top:1rem;display:none}
#menu{font-size:1.5rem;color:#000;display:block;margin-right:0.7rem}

#heading{padding: 6rem 1.25rem;background-color: #49BF4C;color: #fff;text-align: center}
#heading a{white-space:normal;color: #fff;text-decoration: none;border:1px solid #fff}
#heading h1{font-size: 2.5rem;line-height: 2.4rem;margin: 0;margin-bottom:1rem;font-weight: 400}
#wrapper{padding: 2.5rem 1.25rem;}
.leftcol{width: 66.6666%;position: relative;}
.rightcol{width: 33.3333%;}
.fltright{float:right}
.fltleft{float:left}
.rightcol, .leftcol{padding: 0 .625rem;position: relative;}
.entry-content, .entry-summary {color: #555;line-height: 2rem}
.cat_list{border-bottom: 1px solid rgba(0,0,0,.1);margin-bottom: 2.25rem}
.cat_list h2{margin:0;font-size:1.5rem;display:block}
.cat_list a{color: #49BF4C}
.hidden{display:none}
.gsa{text-align:center;margin-bottom:1.25rem;width:100%}
#toc a{display: block;font-weight: bold;text-align:left;white-space:normal}
footer{margin-top:2rem;background:#002633;padding:0.625rem;text-align:center;font-size:0.95rem}
footer,footer a,footer a:hover{color:#7697A2}
.next,.prev{display: inline-block;padding:.6rem;padding-top:0.05rem;padding-bottom:.25rem;border-radius:1rem;font-weight:bold;color:#fff;background:#009600}
@media screen and (max-width: 768px){
.leftcol,.rightcol{width:100%}
video{max-width:100%}
}

</style>

<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-1287605604486981",
          enable_page_level_ads: true
     });
</script>
<link rel='canonical' href='https://brainbell.com/javascript/pause-resume-file-walker.html' />
<script type="text/javascript">var ezouid = "1";</script><base ><script type='text/javascript'>
var ezoTemplate = 'old_site_gc';
if(typeof ezouid == 'undefined')
{
    var ezouid = 'none';
}
var ezoFormfactor = '1';
var ezo_elements_to_check = Array();
</script><!-- START EZHEAD -->
<script data-ezscrex="false" type='text/javascript'>
var soc_app_id = '0';
var did = 83552;
var ezdomain = 'brainbell.com';
var ezoicSearchable = 1;
</script>
<!--{jquery}-->
<!-- END EZHEAD -->
<script data-ezscrex="false" type="text/javascript" data-cfasync="false">var _ezaq = {"ad_cache_level":0,"ad_lazyload_version":0,"city":"Union City","country":"US","days_since_last_visit":-1,"domain_id":83552,"domain_test_group":20200401,"engaged_time_visit":0,"ezcache_level":2,"ezcache_skip_code":0,"form_factor_id":1,"framework_id":1,"is_return_visitor":false,"is_sitespeed":0,"last_page_load":"","last_pageview_id":"","lt_cache_level":0,"metro_code":501,"page_ad_positions":"","page_view_count":23,"page_view_id":"d85368bd-bb6b-4770-7c3b-b142c7edd49f","position_selection_id":0,"postal_code":"07087","pv_event_count":0,"response_size_orig":26037,"response_time_orig":8,"serverid":"3.238.120.170:14843","state":"NJ","t_epoch":1613702847,"template_id":126,"time_on_site_visit":0,"url":"https://www.brainbell.com/javascript/pause-resume-file-walker.html","user_id":0,"word_count":1519,"worst_bad_word_level":0};var _ezExtraQueries = "&ez_orig=1";</script><script data-ezscrex='false' data-cfasync='false' type="text/javascript" src="https://www.brainbell.com/detroitchicago/rochester.js?dcb=192-11&amp;cb=2&amp;v=9" async></script>
<script data-ezscrex='false' data-pagespeed-no-defer data-cfasync='false'>
function create_ezolpl(pvID, rv) {
    var d = new Date();
    d.setTime(d.getTime() + (365*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    __ez.ck.setByCat("ezux_lpl_83552=" + new Date().getTime() + "|" + pvID + "|" + rv + "; " + expires, 3);
}
function attach_ezolpl(pvID, rv) {
    if (document.readyState === "complete") {
        create_ezolpl(pvID, rv);
    }
    if(window.attachEvent) {
        window.attachEvent("onload", create_ezolpl, pvID, rv);
    } else {
        if(window.onload) {
            var curronload = window.onload;
            var newonload = function(evt) {
                curronload(evt);
                create_ezolpl(pvID, rv);
            };
            window.onload = newonload;
        } else {
            window.onload = create_ezolpl.bind(null, pvID, rv);
        }
    }
}

__ez.queue.addFunc("attach_ezolpl", "attach_ezolpl", ["d85368bd-bb6b-4770-7c3b-b142c7edd49f", "false"], false, ['/detroitchicago/boise.js'], true, false, false, false);
</script></head>
<body>
<header role="banner">
	<div class="line">
		<nav id="navbar" role="navigation" aria-label="Primary Menu">
			<a id="navbar-brand" href="https://www.brainbell.com/" rel="home" itemprop="url">Brain<span class="bell">Bell</span><br><span class="slog">makes easier to learn</span></a>
			<span class="button fltright" id="menu">&#9776;</span>
<!--menu-->
<div id="buttons">
<a class="button" title="A+" href="https://www.brainbell.com/tutors/A+/Hardware/">A+ Certification</a>
<a class="button" title="Android" href="https://www.brainbell.com/android/">Android</a>
<a class="button" title="ASP" href="https://www.brainbell.com/tutorials/ASP/">ASP</a>
<a class="button" title="3D, Blender and Unity" href="https://www.brainbell.com/3d/">Blender &amp; Unity</a>
<a class="button" title="C" href="https://www.brainbell.com/tutors/c/Advice_and_Warnings_for_C/">C Language</a>
<a class="button" title="C#" href="https://www.brainbell.com/tutors/C_Sharp/">C#</a>
<a class="button" title="Flash" href="https://www.brainbell.com/tutorials/Flash/">Flash</a>
<a class="button" title="HTML and CSS" href="https://www.brainbell.com/tutorials/HTML_and_CSS/">HTML &amp; CSS</a>
<a class="button" title="Java" href="https://www.brainbell.com/tutorials/java/">Java</a>
<a class="button" title="JavaScript" href="https://www.brainbell.com/javascript/">JavaScript</a>
<a class="button" title="MS Access" href="https://www.brainbell.com/tutorials/ms-office/Access_2003/">MS Access</a>
<a class="button" title="MS Excel" href="https://www.brainbell.com/tutorials/ms-office/excel/">MS Excel</a>
<a class="button" title="MS FrontPage" href="https://www.brainbell.com/tutorials/ms-office/FrontPage_2003/">MS FrontPage</a>
<a class="button" title="MS PowerPoint" href="https://www.brainbell.com/tutorials/ms-office/PowerPoint/">MS PowerPoint</a>
<a class="button" title="MS Word" href="https://www.brainbell.com/tutorials/ms-office/Word/">MS Word</a>
<a class="button" title="MySQL" href="https://www.brainbell.com/tutorials/MySQL/">MySQL</a>
<a class="button" title="Networking" href="https://www.brainbell.com/tutorials/Networking/">Networking</a>
<a class="button" title="Perl CGI" href="https://www.brainbell.com/tutors/Perl/">Perl &amp; CGI</a>
<a class="button" title="PHP &amp; MySQL" href="https://www.brainbell.com/tutorials/php/">PHP &amp; MySQL</a>
<a class="button" title="Adobe Photoshop" href="https://www.brainbell.com/tutorials/Photoshop/">Photoshop</a>
<a class="button" title="Regex" href="https://www.brainbell.com/regex/">Regular Expressions</a>
<a class="button" title="TypeScript" href="https://www.brainbell.com/typescript/">TypeScript</a>
<a class="button" title="Visual Basic" href="https://www.brainbell.com/tutors/Visual_Basic/">Visual Basic</a>
<a class="button" title="XML" href="https://www.brainbell.com/tutorials/XML/">XML</a>
</div>
<!--menu end-->
		</nav>
	</div>
</header>


<main role="main">
<article class="hentry">

<header id="heading">
<a class="button" href="https://www.brainbell.com/javascript/" rel="category tag">JavaScript</a> &mdash; <a class="button" href="https://www.brainbell.com/javascript/node.html" rel="tag">Node</a><h1>Adding pause, resume and filter feature to File Walker</h1>
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- link ad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1287605604486981"
     data-ad-slot="1609644746"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</header>

<div id="wrapper"> 
	<div class="line">
	<div class="leftcol fltleft">
	<div class="entry-summary"><p>In last tutorial we’d learned how to create node.js module using <code>exports</code> statement and converted our <code>FileWalker</code> class into module. Now we’ll further extend our <code>FileWlaker</code> class by adding the <code>pause</code> and <code>resume</code> functionality. We’ll also add two methods <code>filterDir</code> and <code>filterFile</code> to filter out directories and files for inclusion or exclusion.</p></div>	<div class="gsa">
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive top -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1287605604486981"
     data-ad-slot="1025731947"
     data-ad-format="rectangle"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
	</div>		<div class="entry-content">
<p>Following code is the skeleton of our FileWalker module:</p>
<pre>class FileWalker extends EventEmitter {
&nbsp;constructor () {}
 filterDir   () {}
 filterFile  () {}
 start       () {}
 pause       () {}
 resume      () {}
 next        () {}
}</pre>
<p>Lets start with the constructor method.&nbsp;The constructor method is a special method which initializes automatically when an object created within a class. For example, <code>var walker = new FileWalker(path,true);</code>&nbsp; created a new <code>FileWalker</code> object,the <code>path</code> and <code>true</code> values are passes to constructor method so you don’t need to call constructor method separately. Let’s explorer the each method one by one.</p>
<h2>Constructor</h2>
<p>The FileWalker constructor method accept two parameters:</p>
<ul>
<li><code>path</code> : the initial path of a directory which you want to scan recursively</li>
<li><code>debug</code>: to enable debugging in the code. You can provide any value.</li>
</ul>
<pre>constructor (entry,debug){
 super();
 this.isPaused = false;
 this.queue = [];
 this.debug = debug ? true : false;
 this.filter_dir = () =&gt; false;
 this.filter_file = () =&gt; false;
 this.start(entry); 
}</pre>
<h3>Properties of constructor method</h3>
<p>We’ll not directly change the properties value</p>
<p><code>this.isPaused</code>&nbsp;holds the current status for our <strong>Duplicate File Finder</strong> app, the default value is <code>false</code> and will be <code>true</code> if paused. To change its value we’ll use <code>pause()</code>&nbsp;and <code>resume()</code> methods.</p>
<p><code>this.queue</code>&nbsp;an array, it stores the output of <code>readdir</code>&nbsp; from the <code>start()</code> method for later processing.</p>
<p><code>this.debug</code>&nbsp;you will see the debugging result on console when its value is <code>true</code>. To enable debugging for your app see following code:</p>
<pre>let debug = true;
let path = '/a/dir/path';
<span style="font-size: 1rem;">let walker = new FileWalker(path,debug);
</span>//let walker = new FileWalker(path); //no debugging</pre>
<p><code>this.filter_dir</code>&nbsp; a method, returns&nbsp;<code>false</code>&nbsp;value by default.&nbsp; This method will call on every directory and a directory will not processed if the function returned&nbsp;<code>true</code>. You can set a <code>filter_dir</code> function using <code>filterDir()</code> method. For example:</p>
<pre>let walker = new FileWalker(path);
walker.filterDir(&nbsp;(dir,stat) =&gt; {
 //dir will not scan
&nbsp;if (dir == '/do/not/scan/path'){
  return true;
&nbsp;}
/* or one liner code 
 return dir == '/do/not/scan/path');
*/
} )</pre>
<p><code>this.filter_file</code> similar to <code>this.filter_dir</code>, this function calls on every file.</p>
<p><code>this.start(entry)</code> calls the <code>start</code> method to start the app by providing the entry (initial path of a directory).</p>
<h2><code>filterDir (fn)</code> Include or exclude folders</h2>
<p>The FileWalker’s <code>filterDir</code> method accepts one parameter:</p>
<p><code>fn</code> a function provided (optionally) immediately after creating the new <code>FileWalker</code> instance.</p>
<pre>filterDir (fn){
 this.filter_dir = fn;
}</pre>
<p>You can use this method to filter out directories for inclusion or exclusion.&nbsp; For example,&nbsp; you want to scan a path <code>/usr/bell</code>&nbsp;but not its sub-directories:</p>
<pre>let myPath = '/usr/bell';
let walker = new Filewalker(myPath);
walker.filterDir(function(dir,stat){
 if (dir == myPath){
  return false;
 }
 return true;
/* or one liner code
 return dir != myPath;
*/
});</pre>
<p>Note: The <code>return true</code>&nbsp;tells the app to not to scan the directory and <code>return false</code> tells the app to scan the directory.</p>
<p>You also can use node.js <code>stat</code> to further filter out directories:</p>
<pre>let myPath = '/usr/bell';
let walker = new Filewalker(myPath);
walker.filterDir( (dir,stat) =&gt; {
 let mt = Math.round(stat.mtimeMs);
 if (mt &gt; 1536356096483)
  return true;
 return false;
/* or two liner code
 let mt = Math.round(stat.mtimeMs);
 return mt &lt; 1536356096483;
*/ 
});</pre>
<p>In above example, we’ read the directory modification time in milliseconds, round it using <code>Math.round()</code> and then compared it against some milliseconds time so a latest directory will not scan.</p>
<h2><code>filterFile (fn)</code> Include or exclude files</h2>
<p>The <code>filterFile</code> method works very similar to <code>filterDir</code> method. The only difference is that the <code>filterFile</code> method filter out the files while the <code>filterDir</code> filter out the directories / folders.&nbsp;The <code>filterFile</code>&nbsp;method accepts one parameter:</p>
<p><code>fn</code> a function provided (optionally) immediately after creating the new <code>FileWalker</code> instance.</p>
<pre>filterFile (fn){
 this.filter_file = fn;
}</pre>
<p>The following example demonstrate how to filter files for a specific size:</p>
<pre>walker.filterFile((file,stat)=&gt;{
 //files size less than 5kb
 if (stat.size &lt; 500000){
  return false;
 }
 return true;
/* or one liner code
 return stat.size &gt; 500000;
*/
});</pre>
<h2><code>start (path)</code> Starting up the app</h2>
<p>The start method is, the heart of our FileWalker class, responsible for all <code>fs</code> processing, i.e. read a directory and its sub directories, include or exclude directories and files by executing the&nbsp;<code>filter_dir</code> and <code>filter_file</code> property methods sat-up through <code>filterDir</code> and <code>filterFile</code> methods.</p>
<p>The start method accepts one parameter:</p>
<p><code>entry</code> path to process.</p>
<pre>start (entry) {
 fs.lstat(entry, (err,stat) =&gt; {
  if (err){
   this.debug&amp;&amp;console.log('Error stat: '+entry);
   this.emit('error',err,entry,stat);
   this.next();
   return this;
  }

  if (stat.isFile()){
   if (this.filter_file(entry,stat)){
    this.debug&amp;&amp;console.log('filterFile: '+entry);
    return this.next();
   }
   this.debug&amp;&amp;console.log('File: '+entry);
   this.emit('file',entry,stat);
   this.next();
  }
  
  else if (stat.isDirectory()){
   if (this.filter_dir(entry,stat)){
    this.debug&amp;&amp;console.log('filterDir: '+entry);
    return this.next();
   }
   this.debug&amp;&amp;console.log('Dir: '+entry);
   this.emit('dir',entry,stat);
   fs.readdir(entry, (err,files) =&gt; {
    if (err){
     this.debug&amp;&amp;console.log('Error readdir: '+entry);
     this.emit('error',err,entry,stat);
     return this;
    }
	
    Array.prototype.push.apply(this.queue, files.map( file =&gt; {
     return path.join(entry,file);
    }));
	
    this.next();
   });
  }
  
  else {
   this.debug&amp;&amp;console.log('unknown  or inaccessible: '+entry);
   this.emit('unknown',entry,stat);
   this.next()
 }
 });
}
</pre>
<p><code>fs.lstat(entry, (err,stat)</code>&nbsp; Read the stat of entry, if error the&nbsp;<code>this.debug&amp;&amp;console.log('Error stat: '+entry);</code>&nbsp;will print the&nbsp; message on console if the debug option was enabled, then&nbsp;<code>this.emit('error',err,entry,stat);</code> emit error event for further handling of the error, for example:</p>
<pre>let walker = new FileWalker(path); 
walker.on('error' (err,entry,stat) =&gt; {
 //do something
});</pre>
<p><code>this.next();</code> code calls the <code>next</code> method which retrieves the next path (entry) from the <code>queue</code> for processing.</p>
<p>Next, <code>stat.isFile()</code> will return true if the entry is a file.&nbsp; The <code>this.filter_file (entry, stat)</code>&nbsp;will return either true&nbsp; or false,&nbsp; if true we’ll skip this file, not emit the <code>file</code> event, and move to <code>next()</code> entry.</p>
<p><code>stat.isDirectory()</code> return true if directory found, the <code>filter_directory(entry, stat)</code> will return true or false, we’ll not process the directory if it returned <code>true</code>. If false the <code>dir</code> event will fire and we’ll retrieve the entries of the dir using <code>fs.readdir</code> method, again if error occurs while reading the dir the <code>error</code> event will fire.</p>
<p>When we read a directory we receive file names not their full path, we’ll use the <a href="https://nodejs.org/api/path.html#path_path_join_paths"><code>path.join</code></a> method to join the current directory path with retrieved path. We’ll store the whole result in <code>queue</code> array for later processing and call the&nbsp;<code>next()</code> method to process the next entry.</p>
<p>Since our main focus on directories and files, we’ll not process any other file types and emit them as <code>unknown</code> type.</p>
<h2><code>next()</code> Retrieve next path from the queue</h2>
<pre>next(){
 if (this.isPaused) {
  this.emit('pause');
  this.debug&amp;&amp;console.log('isPaused');
  return this;
 }
 let nextEntry = this.queue.shift();
 if (!nextEntry){
  this.emit('done');
  this.debug&amp;&amp;console.log('Done');
  return this;
 }
 this.start(nextEntry);
}</pre>
<p>The next method will emit the pause event if the app was paused and not execute the further code.</p>
<p><code>this.queue.shift()</code> will return the next entry or the <code>done</code> event will fire if there is no more entries found in the queue.</p>
<h2><code>pause()</code> – Pausing the app</h2>
<pre>pause(){
 if (this.isPaused === true){
  debug&amp;&amp;console.log('isPaused failed.App was already paused');
  return this; 
 }
 this.isPaused = true;
}</pre>
<p>This method will change the value of <code>this.isPaused</code> to true, so next method will not retrieve the next entry form the <code>queue</code>. i.e.</p>
<pre>let walker = new FileWalker(path);
setTimeout( () =&gt; {
 walker.pause();
}, 10);</pre>
<h2><code>resume()</code> – Resuming the app</h2>
<pre>resume(){
 if (this.isPaused === false){
  debug&amp;&amp;console.log('Resume failed. App was already resumed');
 return; 
 }
 this.isPaused = false;
 this.debug&amp;&amp;console.log('Resume');
 this.next();
}</pre>
<p>The resume method will change the value of <code>this.isPaused</code> to false and then call the <code>this.next()</code> method to retrieve the next entry. i.e.</p>
<pre>let walker = new FileWalker(path);
setTimeout( () =&gt; {
 walker.pause();
}, 10);

setTimeout( () =&gt; {
 walker.resume();
}, 50);</pre>
<h2>Using FileWalker Module</h2>
<p>Lets import the FileWalker module by providing the full path and create a new FileWalker object, as shown below:</p>
<pre>let Walker = require('./walker.js');
let walker = new Walker('D:\\',true);

walker.filterDir((dir,stat) =&gt; {
 //do not scan following folder
 return dir == 'D:\\brainBell';
});

walker.filterFile((file,stat)=&gt;{
 //exclude files greater than 500kb
 return stat.size &gt; 500000;
});

walker.on('error', (err,stat) =&gt; {
 //an error occurred
})

walker.on('dir', (dir,stat) =&gt; {
 //a directory found
})

walker.on('file', (file,stat) =&gt; {
 //a file found
})

walker.on('pause', () =&gt;{
 //app has been paused
})

walker.on('done', () =&gt; {
 //walker finished its work
})

setTimeout( () =&gt; {
 walker.pause();
}, 10);

setTimeout( () =&gt; {
 walker.resume();
}, 100);</pre>
<h2>How to run FileWalker on your pc</h2>
<p>Download <a href="https://www.brainbell.com/javascript/download/download-walker.html"><code>walker.js</code></a> and <a href="https://www.brainbell.com/javascript/download/download-trywalker.html"><code>trywalker.js</code></a> files in same folder i.e. <code>d:\fw</code> and write <code>node trywalker</code>&nbsp;in command prompt. i.e.</p>
<pre>D:\fw&gt;node trywalker</pre>
<h2>Downloads</h2>
<ol>
<li><a href="https://www.brainbell.com/javascript/download/download-walker.html">walker.js</a></li>
<li><a href="https://www.brainbell.com/javascript/download/download-trywalker.html">trywalker.js</a></li>
</ol>

<p>In next tutorial we'll read about the Node.js child process by running our FileWalker module in the background (as child process).</p> <div class="hidden">by <span class="author vcard"><span class="fn">BrainBell</span></span>updated <time class="entry-date updated" datetime="2018-12-19T21:33:00+00:00">Dec 19, 2018</time></div>
		</div>

	</div>

<div class="rightcol fltright"><style type="text/css">
.adslot_1 { display:inline-block; width: 100%; }
@media (max-width: 768px) { .adslot_1,.sideadh { display: none; } }
</style>
<div class="gsa">
<div class="sideadh">Advertisement:</div>
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive banner right -->
<ins class="adsbygoogle adslot_1"
     data-ad-client="ca-pub-1287605604486981"
     data-ad-slot="2682751945"
     data-ad-format="vertical"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>	</div>
</div>
</article>

<div class="line"><div class="leftcol fltleft">

<div class="gsa">
Advertisement:
<script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive footer -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1287605604486981"
     data-ad-slot="8559331946"
     data-ad-format="rectangle"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

</div><nav><div class="line"><a rel="next" class="button fltright" href="https://www.brainbell.com/javascript/hash-files-in-filewalker.html">Next <span class="next">&gt;</span></a><a rel="prev" class="button  fltleft" href="https://www.brainbell.com/javascript/create-node-modules.html"><span class="prev">&lt;</span> Prev</a></div></nav>
</div><div class="rightcol fltright"></div></div>

	</main>

<footer>
	<section >
		<div class="line">
			<div class="leftcol fltleft">
				<p>Copyright &copy; 2021 BrainBell.com</p>
				<p>Contact us: info&#64;brainbell.com</p>
			</div>
			<div class="rightcol fltright">
				<a href="https://www.brainbell.com/privacy/">Privacy policy</a> &nbsp; : &nbsp;
				<a href="https://www.brainbell.com/terms/">Terms of use</a>
			</div>
		</div>
	</section>
</footer>
<script>
(function(){
var m = document.querySelector('#menu'),n = document.querySelector('#buttons'),o = false;

m.addEventListener('click', function(e){
var d;
o = !o;
if (o) {
m.innerHTML = 'X';
n.style.display = 'block';
n.style.display = 'flex';
m.style.padding = '.375rem .98rem';
}
else{
m.innerHTML = '&#9776;';
n.style.display = 'none';
m.style.padding = '.375rem .75rem';
}});
}());
(function(){
var stop = true, p = document.querySelectorAll('pre');
for (var i in p){p[i].className += ' prettyprint';stop = false;}
if (stop) return;
var script = document.createElement('script');
script.src = 'https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js';
document.head.appendChild(script);}());
</script>
	   <script type='text/javascript' style='display:none;' async>
__ez.queue.addFile('https://www.brainbell.com/javascript/edmonton.php', '/detroitchicago/edmonton.webp?a=a&cb=11&shcb=34', true, ['/detroitchicago/minneapolis.js'], true, false, false, false);
__ez.queue.addFile('https://www.brainbell.com/javascript/jellyfish.php', '/porpoiseant/jellyfish.webp?a=a&cb=11&shcb=34', false, [], true, false, false, false);
</script>

<script>var _audins_dom="brainbell_com",_audins_did=83552;__ez.queue.addDelayFunc("https://www.brainbell.com/javascript/audins.js","__ez.script.add", "http://go.ezoic.net/detroitchicago/audins.js?cb=192-11");</script><noscript><div style="display:none;"><img src="http://pixel.quantserve.com/pixel/p-31iz6hfFutd16.gif?labels=Domain.brainbell_com,DomainId.83552" border="0" height="1" width="1" alt="Quantcast"/></div></noscript>
<script type="text/javascript" data-cfasync="false"></script></body>

<!-- Mirrored from www.brainbell.com/javascript/pause-resume-file-walker.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Feb 2021 02:56:19 GMT -->
</html>

